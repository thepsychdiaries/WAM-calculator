<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Psych Diaries · WAM Calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=Alegreya:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Alegreya, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: #ffffff;
      color: #2b1c18;
      display: grid;
      place-items: center;
      min-height: 100vh;
      padding: 18px;
    }
    .card {
      width: min(860px, 100%);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
      overflow: hidden;
      background: #fff;
    }
    header {
      padding: 18px 18px 10px;
      border-bottom: 1px solid rgba(0,0,0,.06);
      background:
  linear-gradient(180deg, rgba(246,200,208,.35), transparent),
  linear-gradient(0deg, rgba(246,200,208,.35), transparent);

    }
    h1 {
      font-size: 18px;
      margin: 0 0 6px;
      letter-spacing: .2px;
    }
    .sub {
      margin: 0;
      opacity: .78;
      font-size: 13px;
      line-height: 1.4;
    }

    .content { padding: 16px 18px 18px; }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    .btns { display: flex; gap: 10px; flex-wrap: wrap; }
    button {
      border: 0;
      border-radius: 14px;
      padding: 10px 12px;
      cursor: pointer;
      font-weight: 650;
      background: rgba(246,200,208,.9);
      color: #2b1c18;
      box-shadow: 0 8px 18px rgba(0,0,0,.10);
    }
    button.secondary {
      background: rgba(0,0,0,.06);
      box-shadow: none;
      font-weight: 600;
    }
    button:active { transform: translateY(1px); }

    table {
      width: 100%;
      border-collapse: collapse;
      overflow: hidden;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.08);
    }
    thead th {
      text-align: left;
      font-size: 12px;
      letter-spacing: .2px;
      padding: 10px 10px;
      background: rgba(0,0,0,.03);
      border-bottom: 1px solid rgba(0,0,0,.06);
      white-space: nowrap;
    }
    tbody td {
      padding: 10px;
      border-bottom: 1px solid rgba(0,0,0,.06);
      vertical-align: middle;
    }
    tbody tr:last-child td { border-bottom: 0; }

    input[type="text"], input[type="number"] {
      width: 100%;
      border: 1px solid rgba(0,0,0,.14);
      border-radius: 12px;
      padding: 9px 10px;
      outline: none;
      background: #fff;
      color: #2b1c18;
    }
    input[type="number"] { appearance: textfield; }
    input:focus { border-color: rgba(246,200,208, 1); box-shadow: 0 0 0 4px rgba(246,200,208,.25); }

    .rowActions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }
    .iconBtn {
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(0,0,0,.06);
      box-shadow: none;
      font-weight: 700;
    }

    .results {
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .panel {
      border: 1px solid rgba(246,200,208,.15);
      border-radius: 16px;
      padding: 12px;
  background: linear-gradient(
    180deg,
    rgba(246,200,208,.18),
    rgba(246,200,208,.05)
  );
}

    }
    .panel h2 {
      font-size: 13px;
      margin: 0 0 8px;
      opacity: .85;
    }
    .big {
      font-size: 28px;
      font-weight: 800;
      margin: 0;
      letter-spacing: .3px;
    }
    .meta {
      margin: 6px 0 0;
      font-size: 12px;
      opacity: .75;
      line-height: 1.4;
    }

    .goalGrid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 8px;
    }
    .goalGrid label {
      font-size: 12px;
      opacity: .85;
      display: block;
      margin-bottom: 6px;
    }

    .note {
      margin-top: 12px;
      font-size: 12px;
      opacity: .7;
      line-height: 1.45;
    }

    @media (max-width: 720px) {
      .results { grid-template-columns: 1fr; }
      .goalGrid { grid-template-columns: 1fr; }
      thead { display: none; }
      table, tbody, tr, td { display: block; width: 100%; }
      tbody td { border-bottom: 0; padding: 8px 10px; }
      tbody tr { border-bottom: 1px solid rgba(0,0,0,.06); padding: 8px 0; }
      tbody tr:last-child { border-bottom: 0; }
      .rowActions { justify-content: flex-start; padding: 6px 10px 10px; }
      .tdLabel { font-size: 11px; opacity: .7; margin-bottom: 4px; display: block; }
    }
  </style>
</head>
<body>
  <div class="card">
    <header>
      <h1> ✨ The Psych Diaries ⋆ WAM Calculator ✨</h1>
      <p class="sub">Enter your unit marks and credit points (CP). WAM is calculated as a weighted average: Σ(mark × CP) ÷ Σ(CP).</p>
    </header>

    <div class="content">
      <div class="controls">
        <div class="btns">
          <button id="addRowBtn" type="button">+ Add unit</button>
          <button id="addSixBtn" class="secondary" type="button">Add 6</button>
          <button id="resetBtn" class="secondary" type="button">Reset</button>
        </div>
        <div style="font-size:12px;opacity:.75">
          Tip: leave blank rows empty — they’re ignored.
        </div>
      </div>

      <table aria-label="WAM input table">
        <thead>
          <tr>
            <th style="width:42%">Unit (optional)</th>
            <th style="width:18%">Mark (%)</th>
            <th style="width:18%">CP</th>
            <th style="width:22%;text-align:right">Actions</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>

      <div class="results">
        <div class="panel">
          <h2>Your current WAM</h2>
          <p class="big"><span id="wamOut">—</span></p>
          <p class="meta">
            Total CP counted: <strong><span id="cpOut">0</span></strong><br/>
            Units counted: <strong><span id="nOut">0</span></strong>
          </p>
        </div>

        <div class="panel">
          <h2>Target WAM mode</h2>
          <div class="goalGrid">
            <div>
              <label for="targetWam">Target WAM</label>
              <input id="targetWam" type="number" min="0" max="100" step="0.1" placeholder="e.g., 80" />
            </div>
            <div>
              <label for="futureCp">Remaining / future CP</label>
              <input id="futureCp" type="number" min="0" step="1" placeholder="e.g., 40" />
            </div>
            <div>
              <label for="rounding">Rounding</label>
              <input id="rounding" type="number" min="0" max="3" step="1" value="1" />
            </div>
          </div>

          <p class="meta" style="margin-top:10px">
            Required average across remaining CP:
            <strong><span id="needOut">—</span></strong>
          </p>
          <p class="note" id="needNote"></p>
        </div>
      </div>

      <p class="note">
        Note: Different universities sometimes exclude fails/withdrawals or treat some units differently. This widget calculates the standard weighted average by CP.
      </p>
    </div>
  </div>

<script>
  const rowsEl = document.getElementById("rows");
  const addRowBtn = document.getElementById("addRowBtn");
  const addSixBtn = document.getElementById("addSixBtn");
  const resetBtn = document.getElementById("resetBtn");

  const wamOut = document.getElementById("wamOut");
  const cpOut = document.getElementById("cpOut");
  const nOut = document.getElementById("nOut");

  const targetWamEl = document.getElementById("targetWam");
  const futureCpEl = document.getElementById("futureCp");
  const roundingEl = document.getElementById("rounding");
  const needOut = document.getElementById("needOut");
  const needNote = document.getElementById("needNote");

  function makeRow(unit = "", mark = "", cp = "10") {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>
        <span class="tdLabel">Unit</span>
        <input type="text" value="${escapeHtml(unit)}" placeholder="e.g., PSYU1102" aria-label="Unit name">
      </td>
      <td>
        <span class="tdLabel">Mark (%)</span>
        <input type="number" min="0" max="100" step="0.1" value="${mark}" placeholder="e.g., 85" aria-label="Mark">
      </td>
      <td>
        <span class="tdLabel">CP</span>
        <input type="number" min="0" step="1" value="${cp}" placeholder="10" aria-label="Credit points">
      </td>
      <td>
        <div class="rowActions">
          <button type="button" class="iconBtn" title="Duplicate row">⎘</button>
          <button type="button" class="iconBtn" title="Remove row">✕</button>
        </div>
      </td>
    `;

    const inputs = tr.querySelectorAll("input");
    inputs.forEach(i => i.addEventListener("input", recalc));

    const [dupBtn, delBtn] = tr.querySelectorAll("button.iconBtn");
    dupBtn.addEventListener("click", () => {
      const [unitIn, markIn, cpIn] = tr.querySelectorAll("input");
      rowsEl.insertBefore(
        makeRow(unitIn.value, markIn.value, cpIn.value || "10"),
        tr.nextSibling
      );
      recalc();
    });

    delBtn.addEventListener("click", () => {
      tr.remove();
      recalc();
    });

    return tr;
  }

  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g, s => ({
      "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
    }[s]));
  }

  function getData() {
    const rows = Array.from(rowsEl.querySelectorAll("tr"));
    let totalCP = 0;
    let weightedSum = 0;
    let counted = 0;

    for (const tr of rows) {
      const [unitIn, markIn, cpIn] = tr.querySelectorAll("input");
      const mark = parseFloat(markIn.value);
      const cp = parseFloat(cpIn.value);

      // ignore incomplete rows (blank mark or cp)
      if (!Number.isFinite(mark) || !Number.isFinite(cp) || cp <= 0) continue;
      // clamp mark to 0..100 just in case
      const safeMark = Math.min(100, Math.max(0, mark));

      totalCP += cp;
      weightedSum += safeMark * cp;
      counted += 1;
    }

    const wam = totalCP > 0 ? (weightedSum / totalCP) : null;
    return { totalCP, weightedSum, counted, wam };
  }

  function format(num, decimals = 1) {
    return Number(num).toFixed(decimals);
  }

  function recalc() {
    const { totalCP, weightedSum, counted, wam } = getData();

    cpOut.textContent = format(totalCP, 0);
    nOut.textContent = String(counted);

    if (wam === null) {
      wamOut.textContent = "—";
    } else {
      wamOut.textContent = format(wam, 2);
    }

    // Target WAM mode
    const target = parseFloat(targetWamEl.value);
    const futureCP = parseFloat(futureCpEl.value);
    const roundN = Math.min(3, Math.max(0, parseInt(roundingEl.value || "1", 10)));

    needNote.textContent = "";
    if (wam === null || totalCP <= 0 || !Number.isFinite(target) || !Number.isFinite(futureCP) || futureCP <= 0) {
      needOut.textContent = "—";
      return;
    }

    // Required average x across remaining CP:
    // x = (target*(currentCP+futureCP) - currentWeightedSum) / futureCP
    const need = (target * (totalCP + futureCP) - weightedSum) / futureCP;

    if (!Number.isFinite(need)) {
      needOut.textContent = "—";
      return;
    }

    needOut.textContent = format(need, roundN) + "%";

    if (need > 100) {
      needNote.textContent = "That target isn’t achievable with the remaining CP (it would require >100%).";
    } else if (need < 0) {
      needNote.textContent = "You’re already above the target overall (required average < 0%).";
    } else if (need >= 85) {
      needNote.textContent = "Plan mode: you’ll need mostly HD-range marks across remaining units.";
    } else if (need >= 75) {
      needNote.textContent = "Solid — you’ll need strong Distinction-range marks on average.";
    } else if (need >= 65) {
      needNote.textContent = "Doable — keep steady Credit+ marks and you’ll be on track.";
    } else {
      needNote.textContent = "Comfortable — your target is within reach with consistent passes.";
    }
  }

  function addRows(n = 1) {
    for (let i = 0; i < n; i++) rowsEl.appendChild(makeRow());
    recalc();
  }

  function resetAll() {
    rowsEl.innerHTML = "";
    targetWamEl.value = "";
    futureCpEl.value = "";
    roundingEl.value = "1";
    addRows(6);
  }

  addRowBtn.addEventListener("click", () => addRows(1));
  addSixBtn.addEventListener("click", () => addRows(6));
  resetBtn.addEventListener("click", resetAll);

  targetWamEl.addEventListener("input", recalc);
  futureCpEl.addEventListener("input", recalc);
  roundingEl.addEventListener("input", recalc);

  // Start with 6 rows
  addRows(6);
</script>
</body>
</html>
